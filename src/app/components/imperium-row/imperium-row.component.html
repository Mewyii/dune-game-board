<div class="imperium-row-container">
  <div class="heading font-scifi">
    <div>{{ t.translate('imperiumrowHeading') }}</div>
    <div class="persuasion-area font-text" *ngIf="activePlayer">
      <div class="resource-display" [style]="'filter: saturate(0.25);'">
        <img class="resource small" [src]="getEffectTypePath('persuasion')" />
        <div class="resource-amount" *ngIf="activePlayer.permanentPersuasion > 0">
          <span>{{ activePlayer.permanentPersuasion }}</span>
        </div>
      </div>
      +
      <div class="resource-display">
        <img class="resource small" [src]="getEffectTypePath('persuasion')" />
        <div class="resource-amount" *ngIf="activePlayer.persuasionGainedThisRound > 0">
          <span>{{ activePlayer.persuasionGainedThisRound }}</span>
        </div>
      </div>
      =
      <div class="resource-display" [style]="'filter: saturate(1.25) brightness(1.25);'">
        <img class="resource" [src]="getEffectTypePath('persuasion')" />
        <div class="resource-amount" *ngIf="activePlayerPersuasion > 0">
          <span>{{ activePlayerPersuasion }}</span>
        </div>
      </div>
    </div>
  </div>
  <div class="imperium-rows-container">
    <div class="cards-container">
      <div class="imperium-deck-container">
        <div
          [class]="'imperium-deck ' + (activeCardId === 'imperium-deck' ? 'active' : '')"
          (click)="setCardActive('imperium-deck')"
        >
          <div class="imperium-deck-action-container" *ngIf="activeCardId === 'imperium-deck'">
            <button
              class="card-buy-button"
              mat-fab
              [color]="'accent'"
              (click)="onSearchImperiumDeckClicked()"
              [matTooltip]="t.translate('imperiumRowTooltipSearch')"
            >
              <mat-icon>search</mat-icon>
            </button>
            <button
              *ngIf="activePlayer?.turnState === 'reveal' && factionRecruitment.length > 0"
              class="card-buy-button"
              mat-fab
              [color]="'accent'"
              (click)="onRecruitFromImperiumRowClicked()"
              [matTooltip]="t.translate('imperiumRowTooltipRecruit')"
            >
              <mat-icon>how_to_reg</mat-icon>
            </button>
          </div>
        </div>
      </div>
      @for (unlimitedCard of unlimitedCustomCards; track $index) {
      <div
        class="card-container"
        (click)="setCardActive(unlimitedCard.name.en)"
        (mouseenter)="setCardHover(unlimitedCard.name.en)"
        (mouseleave)="hoveredCardId = ''"
      >
        <dune-highlighting
          *ngIf="unlimitedCard.name.en === activeCardId || unlimitedCard.name.en === hoveredCardId"
          [id]="unlimitedCard.name.en"
          [width]="420"
          [height]="570"
          [bottom]="-100"
          [left]="-80"
        >
        </dune-highlighting>
        <dune-imperium-row-card
          [class]="
            (unlimitedCard.name.en === activeCardId ? 'active' : '') +
            (activePlayerTurnState !== 'reveal' ? ' desaturated' : '') +
            (activePlayerTurnState === 'reveal' &&
            unlimitedCard.persuasionCosts &&
            activePlayerPersuasion >= unlimitedCard.persuasionCosts
              ? ' buyable'
              : '')
          "
          [card]="unlimitedCard"
        ></dune-imperium-row-card>

        <div class="card-action-container" *ngIf="unlimitedCard.name.en === activeCardId">
          <button
            class="card-buy-button"
            mat-fab
            [color]="'accent'"
            (click)="onBuyAlwaysAvailableCardClicked(unlimitedCard)"
            [matTooltip]="t.translate('imperiumRowTooltipBuy')"
          >
            <mat-icon>check</mat-icon>
          </button>
        </div>
      </div>
      } @for (limitedCard of limitedCustomCards; track $index) {
      <div
        class="card-container"
        (click)="setCardActive(limitedCard.name.en)"
        (mouseenter)="setCardHover(limitedCard.name.en)"
        (mouseleave)="hoveredCardId = ''"
      >
        <dune-highlighting
          *ngIf="limitedCard.name.en === activeCardId || limitedCard.name.en === hoveredCardId"
          [id]="limitedCard.name.en"
          [width]="420"
          [height]="570"
          [bottom]="-100"
          [left]="-80"
        >
        </dune-highlighting>
        <dune-imperium-row-card
          [class]="
            (limitedCard.name.en === activeCardId ? 'active' : '') +
            (activePlayerTurnState !== 'reveal' ? ' desaturated' : '') +
            (activePlayerTurnState === 'reveal' &&
            limitedCard.persuasionCosts &&
            activePlayerPersuasion >= limitedCard.persuasionCosts
              ? ' buyable'
              : '')
          "
          [card]="limitedCard"
        ></dune-imperium-row-card>
        <div class="card-action-container" *ngIf="limitedCard.name.en === activeCardId">
          <button
            class="card-buy-button"
            mat-fab
            [color]="'accent'"
            (click)="onBuyLimitedCustomCardClicked(limitedCard)"
            [matTooltip]="t.translate('imperiumRowTooltipBuy')"
          >
            <mat-icon>check</mat-icon>
          </button>
        </div>
      </div>
      } @for (card of imperiumRowCardsLeft; track card.id) {
      <div
        class="card-container"
        (click)="setCardActive(card.id)"
        (mouseenter)="setCardHover(card.id)"
        (mouseleave)="hoveredCardId = ''"
      >
        <dune-highlighting
          *ngIf="card.id === activeCardId || card.id === hoveredCardId"
          [id]="card.id"
          [width]="420"
          [height]="570"
          [bottom]="-100"
          [left]="-80"
        >
        </dune-highlighting>
        @if (card.type === 'imperium-card') {
        <dune-imperium-row-card
          [class]="
            (card.id === activeCardId ? 'active ' : '') +
            (activePlayerTurnState !== 'reveal' ? 'desaturated ' : '') +
            (activePlayerTurnState === 'reveal' &&
            card.persuasionCosts &&
            activePlayerPersuasion >= card.persuasionCosts + getCardCostModifier(card)
              ? 'buyable '
              : '') +
            card.status
          "
          [card]="card"
          [costModifier]="getCardCostModifier(card)"
        ></dune-imperium-row-card>
        } @if (card.type === 'plot') {
        <dune-plot-card
          [class]="
            (card.id === activeCardId ? 'active ' : '') +
            (activePlayerTurnState !== 'reveal' ? 'desaturated ' : '') +
            (activePlayerTurnState === 'reveal' &&
            card.persuasionCosts &&
            activePlayerPersuasion >= card.persuasionCosts + getCardCostModifier(card)
              ? 'buyable '
              : '') +
            card.status
          "
          [plot]="card"
          [costModifier]="getCardCostModifier(card)"
        ></dune-plot-card>
        }
        <div class="card-action-container" *ngIf="card.id === activeCardId">
          <button
            class="card-buy-button"
            mat-fab
            [color]="'accent'"
            (click)="onBuyCardClicked(card)"
            [matTooltip]="t.translate('imperiumRowTooltipBuy')"
          >
            <mat-icon>check</mat-icon>
          </button>
          <button
            class="card-remove-button"
            mat-fab
            [color]="'accent'"
            (click)="onRemoveCardClicked(card)"
            [matTooltip]="t.translate('imperiumRowTooltipTrash')"
          >
            <mat-icon>delete</mat-icon>
          </button>
          <button
            *ngIf="playerCanCharm"
            class="card-remove-button"
            mat-fab
            [color]="'accent'"
            (click)="onCharmCardClicked(card)"
            [matTooltip]="t.translate('imperiumRowTooltipCharm')"
          >
            <mat-icon>face_retouching_natural</mat-icon>
          </button>
        </div>
      </div>
      }
    </div>
    <div class="cards-container">
      @for (card of imperiumRowCardsRight; track card.id) {
      <div
        class="card-container"
        (click)="setCardActive(card.id)"
        (mouseenter)="setCardHover(card.id)"
        (mouseleave)="hoveredCardId = ''"
      >
        <dune-highlighting
          *ngIf="card.id === activeCardId || card.id === hoveredCardId"
          [id]="card.id"
          [width]="420"
          [height]="570"
          [bottom]="-100"
          [left]="-80"
        >
        </dune-highlighting>
        @if (card.type === 'imperium-card') {
        <dune-imperium-row-card
          [class]="
            (card.id === activeCardId ? 'active ' : '') +
            (activePlayerTurnState !== 'reveal' ? 'desaturated ' : '') +
            (activePlayerTurnState === 'reveal' &&
            card.persuasionCosts &&
            activePlayerPersuasion >= card.persuasionCosts + getCardCostModifier(card)
              ? 'buyable '
              : '') +
            card.status
          "
          [card]="card"
          [costModifier]="getCardCostModifier(card)"
        ></dune-imperium-row-card>
        } @if (card.type === 'plot') {
        <dune-plot-card
          [class]="
            (card.id === activeCardId ? 'active ' : '') +
            (activePlayerTurnState !== 'reveal' ? 'desaturated ' : '') +
            (activePlayerTurnState === 'reveal' &&
            card.persuasionCosts &&
            activePlayerPersuasion >= card.persuasionCosts + getCardCostModifier(card)
              ? 'buyable '
              : '') +
            card.status
          "
          [plot]="card"
          [costModifier]="getCardCostModifier(card)"
        ></dune-plot-card>
        }
        <div class="card-action-container" *ngIf="card.id === activeCardId">
          <button
            class="card-buy-button"
            mat-fab
            [color]="'accent'"
            (click)="onBuyCardClicked(card)"
            [matTooltip]="t.translate('imperiumRowTooltipBuy')"
          >
            <mat-icon>check</mat-icon>
          </button>
          <button
            class="card-remove-button"
            mat-fab
            [color]="'accent'"
            (click)="onRemoveCardClicked(card)"
            [matTooltip]="t.translate('imperiumRowTooltipTrash')"
          >
            <mat-icon>delete</mat-icon>
          </button>
          <button
            *ngIf="playerCanCharm"
            class="card-remove-button"
            mat-fab
            [color]="'accent'"
            (click)="onCharmCardClicked(card)"
            [matTooltip]="t.translate('imperiumRowTooltipCharm')"
          >
            <mat-icon>face_retouching_natural</mat-icon>
          </button>
        </div>
      </div>
      }
    </div>
  </div>
</div>
